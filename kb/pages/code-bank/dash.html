<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dash - VG101 Knowledge Base</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Lora:ital,wght@0,400;0,500;1,400&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../css/style.css">
  <style>
    .register{margin:2rem 0;border-radius:8px;overflow:hidden}
    .register-header{padding:1rem 1.5rem;font-weight:600;font-size:.875rem;text-transform:uppercase;letter-spacing:.05em;cursor:pointer;display:flex;justify-content:space-between;align-items:center}
    .register-header::after{content:'â–¼';font-size:.75rem;transition:transform .2s}
    .register.collapsed .register-header::after{transform:rotate(-90deg)}
    .register-content{padding:1.5rem;border-top:1px solid rgba(0,0,0,0.1)}
    .register.collapsed .register-content{display:none}
    .register--practice{background:#f0fdfa;border:2px solid #14b8a6}
    .register--practice .register-header{background:#14b8a6;color:#fff}
    .register--practice .register-content{border-color:#99f6e4}
    .register--craft{background:#eff6ff;border:2px solid #3b82f6}
    .register--craft .register-header{background:#3b82f6;color:#fff}
    .register--craft .register-content{border-color:#bfdbfe}
    .register--theory{background:#faf5ff;border:2px solid #a855f7}
    .register--theory .register-header{background:#a855f7;color:#fff}
    .register--theory .register-content{border-color:#e9d5ff}
    .register-content h3{margin-top:0}
    .register-content h3:not(:first-child){margin-top:1.5rem}
    .register-label{font-size:.75rem;opacity:.8;font-weight:400;text-transform:none;letter-spacing:normal}
    .term{color:#c49a2e;text-decoration:underline;text-decoration-style:dotted;text-underline-offset:2px}
    .term:hover{color:#d97706}
    /* Perspective tabs */
    .perspective-tabs{margin:1.5rem 0}
    .perspective-tabs input[type="radio"]{display:none}
    .tab-labels{display:flex;gap:0;border-bottom:2px solid #e5e7eb;margin-bottom:1rem}
    .tab-labels label{padding:.75rem 1.25rem;cursor:pointer;font-weight:500;color:#6b7280;border-bottom:2px solid transparent;margin-bottom:-2px;transition:all .2s}
    .tab-labels label:hover{color:#374151;background:#f9fafb}
    .tab-content{display:none;animation:fadeIn .2s ease}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    #tab-2d:checked ~ .tab-labels label[for="tab-2d"],
    #tab-3d:checked ~ .tab-labels label[for="tab-3d"]{color:#14b8a6;border-bottom-color:#14b8a6}
    #tab-2d:checked ~ #content-2d,
    #tab-3d:checked ~ #content-3d{display:block}
    .input-ref{background:#f5f0e0;border:1px solid #c49a2e;border-radius:6px;padding:1rem;margin:1rem 0}
    .input-ref a{color:#d97706;font-weight:500}
  </style>
</head>
<body>
  <button class="mobile-nav-toggle" aria-label="Toggle navigation menu">
    <span></span><span></span><span></span>
  </button>

  <div class="site-container">
    <nav class="sidebar">
      <a href="../../../index.html" class="site-title">&larr; marty64.net</a>
      <p class="site-subtitle">VG101 Knowledge Base</p>

      <a href="../../index.html" class="nav-home">&larr; VG101 Home</a>

      <div class="nav-section">
        <div class="nav-section-title">Core Framework</div>
        <ul class="nav-list">
          <li class="nav-item"><a href="../framework/gesture.html" class="nav-link">Gesture</a></li>
          <li class="nav-item"><a href="../framework/the-four-as.html" class="nav-link">The 4 A's</a></li>
          <li class="nav-item"><a href="../framework/aesthetic-heritage.html" class="nav-link">Aesthetic Heritage</a></li>
          <li class="nav-item"><a href="../framework/permissions.html" class="nav-link">Permissions</a></li>
        </ul>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Foundations</div>
        <ul class="nav-list">
          <li class="nav-item"><a href="../foundations/what-makes-a-videogame.html" class="nav-link">What Makes a Videogame</a></li>
          <li class="nav-item"><a href="../foundations/the-weekly-rhythm.html" class="nav-link">The Weekly Rhythm</a></li>
          <li class="nav-item"><a href="../foundations/player-psychology.html" class="nav-link">Player Psychology</a></li>
          <li class="nav-item"><a href="../foundations/the-design-lens.html" class="nav-link">The Design Lens</a></li>
        </ul>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Narrative</div>
        <ul class="nav-list">
          <li class="nav-item"><a href="../narrative/index.html" class="nav-link">Overview</a></li>
          <li class="nav-item"><a href="../narrative/environmental-storytelling.html" class="nav-link">Environmental Storytelling</a></li>
          <li class="nav-item"><a href="../narrative/branching-consequence.html" class="nav-link">Branching &amp; Consequence</a></li>
          <li class="nav-item"><a href="../narrative/dialogue-systems.html" class="nav-link">Dialogue Systems</a></li>
          <li class="nav-item"><a href="../narrative/ludonarrative-harmony.html" class="nav-link">Ludonarrative Harmony</a></li>
        </ul>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Level Design</div>
        <ul class="nav-list">
          <li class="nav-item"><a href="../level-design/index.html" class="nav-link">Overview</a></li>
          <li class="nav-item"><a href="../level-design/spatial-communication.html" class="nav-link">Spatial Communication</a></li>
          <li class="nav-item"><a href="../level-design/pacing-flow.html" class="nav-link">Pacing &amp; Flow</a></li>
          <li class="nav-item"><a href="../level-design/guidance-without-handholding.html" class="nav-link">Guidance Without Hand-Holding</a></li>
          <li class="nav-item"><a href="../level-design/verticality-sightlines.html" class="nav-link">Verticality &amp; Sight Lines</a></li>
        </ul>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Systems</div>
        <ul class="nav-list">
          <li class="nav-item"><a href="../systems/index.html" class="nav-link">Overview</a></li>
          <li class="nav-item"><a href="../systems/economy-resources.html" class="nav-link">Economy &amp; Resources</a></li>
          <li class="nav-item"><a href="../systems/progression-systems.html" class="nav-link">Progression Systems</a></li>
          <li class="nav-item"><a href="../systems/balance-philosophy.html" class="nav-link">Balance Philosophy</a></li>
          <li class="nav-item"><a href="../systems/emergent-behavior.html" class="nav-link">Emergent Behavior</a></li>
        </ul>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Pedagogy</div>
        <ul class="nav-list">
          <li class="nav-item"><a href="../pedagogy/index.html" class="nav-link">Overview</a></li>
          <li class="nav-item"><a href="../pedagogy/play-name-make-reflect.html" class="nav-link">Play, Name, Make, Reflect</a></li>
          <li class="nav-item"><a href="../pedagogy/why-unity.html" class="nav-link">Why Unity</a></li>
          <li class="nav-item"><a href="../pedagogy/the-final-project.html" class="nav-link">The Final Project</a></li>
          <li class="nav-item"><a href="../pedagogy/debugging-as-literacy.html" class="nav-link">Debugging as Literacy</a></li>
          <li class="nav-item"><a href="../pedagogy/accessibility-as-craft.html" class="nav-link">Accessibility as Craft</a></li>
          <li class="nav-item"><a href="../pedagogy/code-as-material.html" class="nav-link">Code as Material</a></li>
        </ul>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Code Bank</div>
        <ul class="nav-list">
          <li class="nav-item"><a href="index.html" class="nav-link">Overview</a></li>
          <li class="nav-item"><a href="input-setup.html" class="nav-link">Input Setup</a></li>
          <li class="nav-item"><a href="basic-jump.html" class="nav-link">Basic Jump</a></li>
          <li class="nav-item"><a href="variable-jump.html" class="nav-link">Variable Jump</a></li>
          <li class="nav-item"><a href="double-jump.html" class="nav-link">Double Jump</a></li>
          <li class="nav-item"><a href="coyote-time.html" class="nav-link">Coyote Time</a></li>
          <li class="nav-item"><a href="input-buffer.html" class="nav-link">Input Buffer</a></li>
          <li class="nav-item"><a href="dash.html" class="nav-link active">Dash</a></li>
          <li class="nav-item"><a href="hitstop.html" class="nav-link">Hitstop</a></li>
          <li class="nav-item"><a href="knockback.html" class="nav-link">Knockback</a></li>
          <li class="nav-item"><a href="squash-stretch.html" class="nav-link">Squash &amp; Stretch</a></li>
          <li class="nav-item"><a href="screen-shake.html" class="nav-link">Screen Shake</a></li>
        </ul>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Case Studies</div>
        <ul class="nav-list">
          <li class="nav-item"><a href="../case-studies/index.html" class="nav-link">Overview</a></li>
          <li class="nav-item"><a href="../case-studies/celeste-dash.html" class="nav-link">Celeste: Dash</a></li>
          <li class="nav-item"><a href="../case-studies/celeste-assist-mode.html" class="nav-link">Celeste: Assist Mode</a></li>
          <li class="nav-item"><a href="../case-studies/dark-souls-bonfire.html" class="nav-link">Dark Souls: Bonfire</a></li>
          <li class="nav-item"><a href="../case-studies/hades-god-mode.html" class="nav-link">Hades: God Mode</a></li>
          <li class="nav-item"><a href="../case-studies/portal-level-one.html" class="nav-link">Portal: Level One</a></li>
          <li class="nav-item"><a href="../case-studies/undertale-genocide.html" class="nav-link">Undertale: Genocide</a></li>
        </ul>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Resources</div>
        <ul class="nav-list">
          <li class="nav-item"><a href="../glossary.html" class="nav-link">Glossary</a></li>
          <li class="nav-item"><a href="../references.html" class="nav-link">References</a></li>
        </ul>
      </div>
    </nav>

    <main class="main-content">
      <div class="content-wrapper">
        <nav class="breadcrumb">
          <a href="../../index.html">VG101</a> / <a href="index.html">Code Bank</a> / Dash
        </nav>

        <h1>Dash</h1>

        <p class="lead">
          A burst of movement in a direction. Quick, committed, often with invincibility. The defining gesture of modern action platformers.
        </p>

        <!-- PRACTICE REGISTER -->
        <div class="register register--practice">
          <div class="register-header" onclick="this.parentElement.classList.toggle('collapsed')">
            Practice <span class="register-label">- what you do</span>
          </div>
          <div class="register-content">
            <h3>The Feel</h3>
            <p>Dash is <strong>explosive and committed</strong>. You press, you move, no take-backs. The commitment creates tension; the burst creates power.</p>

            <h3>Exposed Variables</h3>
            <table>
              <thead>
                <tr>
                  <th>Variable</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>What it does</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><code>dashSpeed</code></td>
                  <td>float</td>
                  <td>25.0</td>
                  <td>How fast you move during dash</td>
                </tr>
                <tr>
                  <td><code>dashDuration</code></td>
                  <td>float</td>
                  <td>0.15</td>
                  <td>How long the dash lasts (seconds)</td>
                </tr>
                <tr>
                  <td><code>dashCooldown</code></td>
                  <td>float</td>
                  <td>0.0</td>
                  <td>Time before you can dash again</td>
                </tr>
                <tr>
                  <td><code>dashDirection</code></td>
                  <td>enum</td>
                  <td>EightWay</td>
                  <td>Which directions are valid</td>
                </tr>
                <tr>
                  <td><code>dashCount</code></td>
                  <td>int</td>
                  <td>1</td>
                  <td>Dashes available per air period</td>
                </tr>
                <tr>
                  <td><code>refreshOnGround</code></td>
                  <td>bool</td>
                  <td>true</td>
                  <td>Does landing restore dash?</td>
                </tr>
                <tr>
                  <td><code>invincibleDuringDash</code></td>
                  <td>bool</td>
                  <td>false</td>
                  <td>Ignore damage while dashing?</td>
                </tr>
                <tr>
                  <td><code>cancelWindow</code></td>
                  <td>float</td>
                  <td>0.0</td>
                  <td>When can you cancel into other actions?</td>
                </tr>
                <tr>
                  <td><code>momentumTransfer</code></td>
                  <td>float</td>
                  <td>0.0</td>
                  <td>How much dash speed carries into normal movement</td>
                </tr>
              </tbody>
            </table>

            <h3>Tuning Guide</h3>

            <p><strong>Celeste-style (precise, resource-based):</strong></p>
            <ul>
              <li><code>dashSpeed</code>: 25</li>
              <li><code>dashDuration</code>: 0.12-0.15</li>
              <li><code>dashCount</code>: 1</li>
              <li><code>dashDirection</code>: EightWay</li>
              <li><code>refreshOnGround</code>: true</li>
              <li><code>invincibleDuringDash</code>: true (brief)</li>
              <li><code>momentumTransfer</code>: 0</li>
            </ul>
            <p><em>One dash per airtime, eight directions, full commitment</em></p>

            <p><strong>Hades-style (combat, spammable):</strong></p>
            <ul>
              <li><code>dashSpeed</code>: 18</li>
              <li><code>dashDuration</code>: 0.1</li>
              <li><code>dashCooldown</code>: 0.3</li>
              <li><code>dashCount</code>: unlimited (via cooldown)</li>
              <li><code>dashDirection</code>: EightWay</li>
              <li><code>invincibleDuringDash</code>: true</li>
              <li><code>cancelWindow</code>: 0.05</li>
            </ul>
            <p><em>Faster, shorter dashes you can chain</em></p>

            <p><strong>Mega Man X-style (ground only, forward):</strong></p>
            <ul>
              <li><code>dashSpeed</code>: 15</li>
              <li><code>dashDuration</code>: 0.3</li>
              <li><code>dashDirection</code>: Horizontal</li>
              <li><code>dashCooldown</code>: 0</li>
              <li><code>groundOnly</code>: true (separate variable)</li>
            </ul>
            <p><em>Longer duration, ground-based</em></p>

            <h3>Pseudocode</h3>
            <pre><code>On Dash Press (if dashCount > 0):
  - Record dash direction from input
  - Set dash state
  - Start dash timer
  - If invincible: enable invincibility frames

During Dash:
  - Override normal movement with dashSpeed in dashDirection
  - Ignore gravity (optional)
  - Check for cancel window inputs

On Dash End:
  - Return to normal movement
  - Apply momentum transfer if any
  - Start cooldown timer if applicable
  - Decrement dashCount

On Ground Contact:
  - If refreshOnGround: restore dashCount</code></pre>

            <div class="input-ref">
              <strong>Prerequisite:</strong> These scripts use the <a href="input-setup.html">InputReader</a> pattern for device-agnostic input. Set that up first.
            </div>

            <div class="perspective-tabs">
              <input type="radio" name="perspective" id="tab-2d" checked>
              <input type="radio" name="perspective" id="tab-3d">

              <div class="tab-labels">
                <label for="tab-2d">2D Platformer</label>
                <label for="tab-3d">3D (All Perspectives)</label>
              </div>

              <!-- 2D CONTENT -->
              <div class="tab-content" id="content-2d">
                <h3>Unity Setup (2D)</h3>
                <ol>
                  <li><strong>InputReader Setup:</strong> See <a href="input-setup.html">Input Setup</a> page - ensure you have a "Dash" action (Button type) bound to Left Shift and Right Trigger</li>
                  <li><strong>Player Setup:</strong>
                    <ul>
                      <li>Add <code>Rigidbody2D</code> (Gravity Scale: 3, Freeze Rotation Z: checked)</li>
                      <li>Add <code>Collider2D</code> (BoxCollider2D or CapsuleCollider2D)</li>
                      <li>Add the <code>Dash2D.cs</code> script below</li>
                    </ul>
                  </li>
                  <li><strong>Ground Check:</strong> Create empty child object at player's feet, assign to <code>groundCheck</code></li>
                  <li><strong>Layers:</strong> Create "Ground" layer, assign to ground objects, set in script's Inspector</li>
                </ol>

                <h3>The Script (2D)</h3>
                <details class="code-block">
                  <summary>Dash2D.cs</summary>
                <pre><code>// ============================================================
// Dash2D.cs
// 2D dash with direction options, resource management,
// invincibility, and momentum transfer.
// Uses InputReader for device-agnostic input (gamepad + KB/M).
// Unity 6.x + New Input System
// ============================================================

using UnityEngine;

public enum DashDirectionMode2D
{
    EightWay,       // All 8 cardinal + diagonal directions
    FourWay,        // Up, Down, Left, Right only
    Horizontal,     // Left and Right only
    FacingDirection // Dash the way sprite is facing
}

[RequireComponent(typeof(Rigidbody2D))]
public class Dash2D : MonoBehaviour
{
    [Header("Dash Settings")]
    [Tooltip("Speed during dash (units/second)")]
    [SerializeField] private float dashSpeed = 25f;

    [Tooltip("Duration of the dash (seconds)")]
    [SerializeField] private float dashDuration = 0.15f;

    [Tooltip("Cooldown before next dash (0 = none)")]
    [SerializeField] private float dashCooldown = 0f;

    [Header("Direction")]
    [Tooltip("Which directions are valid")]
    [SerializeField] private DashDirectionMode2D directionMode = DashDirectionMode2D.EightWay;

    [Tooltip("Default direction if no input (1=right, -1=left)")]
    [SerializeField] private int facingDirection = 1;

    [Header("Resource Management")]
    [Tooltip("Dashes available per air period")]
    [SerializeField] private int maxDashCount = 1;

    [Tooltip("Landing restores dashes?")]
    [SerializeField] private bool refreshOnGround = true;

    [Header("Combat")]
    [Tooltip("Invincible while dashing?")]
    [SerializeField] private bool invincibleDuringDash = false;

    [Tooltip("Momentum carried after dash (0-1)")]
    [SerializeField] [Range(0f, 1f)] private float momentumTransfer = 0f;

    [Header("Ground Detection")]
    [SerializeField] private Transform groundCheck;
    [SerializeField] private float groundCheckRadius = 0.1f;
    [SerializeField] private LayerMask groundLayer;

    // Components
    private Rigidbody2D rb;

    // Dash state
    private bool isDashing;
    private float dashTimer;
    private float cooldownTimer;
    private int dashesRemaining;
    private Vector2 dashDirection;
    private float storedGravityScale;

    // Ground state
    private bool isGrounded;
    private bool wasGrounded;

    // Public properties
    public bool IsDashing =&gt; isDashing;
    public bool IsInvincible =&gt; isDashing &amp;&amp; invincibleDuringDash;
    public int DashesRemaining =&gt; dashesRemaining;
    public bool CanDash =&gt; !isDashing &amp;&amp; dashesRemaining &gt; 0 &amp;&amp; cooldownTimer &lt;= 0f;

    void Awake()
    {
        rb = GetComponent&lt;Rigidbody2D&gt;();
        storedGravityScale = rb.gravityScale;
        dashesRemaining = maxDashCount;
    }

    void OnEnable()
    {
        InputReader.Instance.OnDashPressed += TryDash;
    }

    void OnDisable()
    {
        InputReader.Instance.OnDashPressed -= TryDash;
    }

    void Update()
    {
        if (cooldownTimer &gt; 0f)
            cooldownTimer -= Time.deltaTime;

        CheckGroundState();
    }

    void FixedUpdate()
    {
        if (isDashing)
            ProcessDash();
    }

    private void TryDash()
    {
        if (!CanDash) return;

        dashDirection = CalculateDashDirection();
        if (dashDirection == Vector2.zero) return;

        StartDash();
    }

    private Vector2 CalculateDashDirection()
    {
        Vector2 input = InputReader.Instance.MoveInput;

        switch (directionMode)
        {
            case DashDirectionMode2D.EightWay:
                if (input.magnitude &gt; 0.1f)
                    return input.normalized;
                return new Vector2(facingDirection, 0);

            case DashDirectionMode2D.FourWay:
                if (Mathf.Abs(input.x) &gt; Mathf.Abs(input.y))
                    return new Vector2(Mathf.Sign(input.x), 0);
                else if (Mathf.Abs(input.y) &gt; 0.1f)
                    return new Vector2(0, Mathf.Sign(input.y));
                return new Vector2(facingDirection, 0);

            case DashDirectionMode2D.Horizontal:
                if (Mathf.Abs(input.x) &gt; 0.1f)
                    return new Vector2(Mathf.Sign(input.x), 0);
                return new Vector2(facingDirection, 0);

            case DashDirectionMode2D.FacingDirection:
                return new Vector2(facingDirection, 0);

            default:
                return new Vector2(facingDirection, 0);
        }
    }

    private void StartDash()
    {
        isDashing = true;
        dashTimer = dashDuration;
        dashesRemaining--;

        storedGravityScale = rb.gravityScale;
        rb.gravityScale = 0f;
        rb.linearVelocity = dashDirection * dashSpeed;
    }

    private void ProcessDash()
    {
        dashTimer -= Time.fixedDeltaTime;
        rb.linearVelocity = dashDirection * dashSpeed;

        if (dashTimer &lt;= 0f)
            EndDash();
    }

    private void EndDash()
    {
        isDashing = false;
        rb.gravityScale = storedGravityScale;
        rb.linearVelocity *= momentumTransfer;
        cooldownTimer = dashCooldown;
    }

    private void CheckGroundState()
    {
        wasGrounded = isGrounded;

        if (groundCheck != null)
        {
            isGrounded = Physics2D.OverlapCircle(
                groundCheck.position,
                groundCheckRadius,
                groundLayer
            );
        }

        if (refreshOnGround &amp;&amp; isGrounded &amp;&amp; !wasGrounded)
            dashesRemaining = maxDashCount;
    }

    // Public API
    public void RefreshDashes() =&gt; dashesRemaining = maxDashCount;
    public void SetFacingDirection(int dir) =&gt; facingDirection = dir &gt; 0 ? 1 : -1;
    public void CancelDash() { if (isDashing) EndDash(); }

    void OnDrawGizmosSelected()
    {
        if (groundCheck != null)
        {
            Gizmos.color = Color.green;
            Gizmos.DrawWireSphere(groundCheck.position, groundCheckRadius);
        }
    }
}</code></pre>
                </details>
              </div>

              <!-- 3D CONTENT -->
              <div class="tab-content" id="content-3d">
                <h3>Unity Setup (3D - Third Person, First Person, or Isometric)</h3>
                <ol>
                  <li><strong>InputReader Setup:</strong> See <a href="input-setup.html">Input Setup</a> page - ensure you have a "Dash" action (Button type)</li>
                  <li><strong>Player Setup:</strong>
                    <ul>
                      <li>Add <code>CharacterController</code> component</li>
                      <li>Add the <code>Dash3D.cs</code> script below</li>
                    </ul>
                  </li>
                  <li><strong>Optional - Assign Camera:</strong> For camera-relative dashing, assign your main camera to the <code>playerCamera</code> field</li>
                </ol>

                <h3>The Script (3D)</h3>
                <details class="code-block">
                  <summary>Dash3D.cs</summary>
                <pre><code>// ============================================================
// Dash3D.cs
// 3D dash for third-person, first-person, or isometric.
// Uses CharacterController and InputReader for device-agnostic
// input (gamepad + KB/M). Works with camera-relative movement.
// Unity 6.x + New Input System
// ============================================================

using UnityEngine;

public enum DashDirectionMode3D
{
    EightWay,       // 8 directions on XZ plane
    FourWay,        // Cardinal directions only
    Forward,        // Always forward
    CameraRelative  // Based on camera facing
}

[RequireComponent(typeof(CharacterController))]
public class Dash3D : MonoBehaviour
{
    [Header("Dash Settings")]
    [Tooltip("Speed during dash (units/second)")]
    [SerializeField] private float dashSpeed = 25f;

    [Tooltip("Duration of the dash (seconds)")]
    [SerializeField] private float dashDuration = 0.15f;

    [Tooltip("Cooldown before next dash (0 = none)")]
    [SerializeField] private float dashCooldown = 0f;

    [Header("Direction")]
    [Tooltip("Which directions are valid")]
    [SerializeField] private DashDirectionMode3D directionMode = DashDirectionMode3D.CameraRelative;

    [Tooltip("Camera for relative movement (optional)")]
    [SerializeField] private Transform playerCamera;

    [Header("Resource Management")]
    [Tooltip("Dashes available per air period")]
    [SerializeField] private int maxDashCount = 1;

    [Tooltip("Landing restores dashes?")]
    [SerializeField] private bool refreshOnGround = true;

    [Header("Combat")]
    [Tooltip("Invincible while dashing?")]
    [SerializeField] private bool invincibleDuringDash = false;

    [Tooltip("Momentum carried after dash (0-1)")]
    [SerializeField] [Range(0f, 1f)] private float momentumTransfer = 0f;

    [Header("Vertical Behavior")]
    [Tooltip("Ignore gravity during dash?")]
    [SerializeField] private bool suspendGravity = true;

    [Tooltip("Allow vertical dashing (up/down)?")]
    [SerializeField] private bool allowVerticalDash = false;

    // Components
    private CharacterController controller;

    // Dash state
    private bool isDashing;
    private float dashTimer;
    private float cooldownTimer;
    private int dashesRemaining;
    private Vector3 dashDirection;
    private Vector3 dashVelocity;

    // Ground state
    private bool wasGrounded;

    // Public properties
    public bool IsDashing =&gt; isDashing;
    public bool IsInvincible =&gt; isDashing &amp;&amp; invincibleDuringDash;
    public int DashesRemaining =&gt; dashesRemaining;
    public bool CanDash =&gt; !isDashing &amp;&amp; dashesRemaining &gt; 0 &amp;&amp; cooldownTimer &lt;= 0f;

    // For external movement scripts to read
    public Vector3 DashVelocity =&gt; isDashing ? dashVelocity : Vector3.zero;

    void Awake()
    {
        controller = GetComponent&lt;CharacterController&gt;();
        dashesRemaining = maxDashCount;

        if (playerCamera == null)
            playerCamera = Camera.main?.transform;
    }

    void OnEnable()
    {
        InputReader.Instance.OnDashPressed += TryDash;
    }

    void OnDisable()
    {
        InputReader.Instance.OnDashPressed -= TryDash;
    }

    void Update()
    {
        if (cooldownTimer &gt; 0f)
            cooldownTimer -= Time.deltaTime;

        CheckGroundState();

        if (isDashing)
            ProcessDash();
    }

    private void TryDash()
    {
        if (!CanDash) return;

        dashDirection = CalculateDashDirection();
        if (dashDirection == Vector3.zero) return;

        StartDash();
    }

    private Vector3 CalculateDashDirection()
    {
        Vector2 input = InputReader.Instance.MoveInput;
        Vector3 direction = Vector3.zero;

        switch (directionMode)
        {
            case DashDirectionMode3D.CameraRelative:
                if (playerCamera != null &amp;&amp; input.magnitude &gt; 0.1f)
                {
                    Vector3 camForward = playerCamera.forward;
                    Vector3 camRight = playerCamera.right;

                    if (!allowVerticalDash)
                    {
                        camForward.y = 0;
                        camRight.y = 0;
                        camForward.Normalize();
                        camRight.Normalize();
                    }

                    direction = (camForward * input.y + camRight * input.x).normalized;
                }
                else
                {
                    direction = transform.forward;
                }
                break;

            case DashDirectionMode3D.EightWay:
                if (input.magnitude &gt; 0.1f)
                    direction = new Vector3(input.x, 0, input.y).normalized;
                else
                    direction = transform.forward;
                break;

            case DashDirectionMode3D.FourWay:
                if (Mathf.Abs(input.x) &gt; Mathf.Abs(input.y))
                    direction = new Vector3(Mathf.Sign(input.x), 0, 0);
                else if (Mathf.Abs(input.y) &gt; 0.1f)
                    direction = new Vector3(0, 0, Mathf.Sign(input.y));
                else
                    direction = transform.forward;
                break;

            case DashDirectionMode3D.Forward:
                direction = transform.forward;
                break;
        }

        return direction;
    }

    private void StartDash()
    {
        isDashing = true;
        dashTimer = dashDuration;
        dashesRemaining--;
        dashVelocity = dashDirection * dashSpeed;
    }

    private void ProcessDash()
    {
        dashTimer -= Time.deltaTime;

        Vector3 movement = dashVelocity * Time.deltaTime;

        if (!suspendGravity &amp;&amp; !controller.isGrounded)
            movement.y -= 9.81f * Time.deltaTime;

        controller.Move(movement);

        if (dashTimer &lt;= 0f)
            EndDash();
    }

    private void EndDash()
    {
        isDashing = false;
        dashVelocity *= momentumTransfer;
        cooldownTimer = dashCooldown;
    }

    private void CheckGroundState()
    {
        bool isGrounded = controller.isGrounded;

        if (refreshOnGround &amp;&amp; isGrounded &amp;&amp; !wasGrounded)
            dashesRemaining = maxDashCount;

        wasGrounded = isGrounded;
    }

    // Public API
    public void RefreshDashes() =&gt; dashesRemaining = maxDashCount;
    public void CancelDash() { if (isDashing) EndDash(); }

    void OnDrawGizmosSelected()
    {
        if (isDashing)
        {
            Gizmos.color = Color.cyan;
            Gizmos.DrawRay(transform.position, dashDirection * 2f);
        }
    }
}

// ============================================================
// INTEGRATION WITH YOUR MOVEMENT SCRIPT:
//
// If you have a separate movement script using CharacterController,
// check for IsDashing before applying your own movement:
//
// void Update()
// {
//     if (dash.IsDashing) return; // Let dash handle movement
//
//     // Your normal movement code here...
// }
//
// Or combine velocities by reading DashVelocity:
//
// Vector3 totalVelocity = myVelocity + dash.DashVelocity;
// controller.Move(totalVelocity * Time.deltaTime);
// ============================================================</code></pre>
                </details>
              </div>
            </div>

            <h3>Common Issues</h3>
            <p><strong>"The dash feels weak"</strong><br>
            Increase <code>dashSpeed</code>. Dash should feel noticeably faster than running.</p>

            <p><strong>"I can't control where I'm going"</strong><br>
            Check <code>dashDirection</code>. If set to four-way, you might expect eight. Also check input handling for diagonals.</p>

            <p><strong>"The dash is too short/long"</strong><br>
            Adjust <code>dashDuration</code>. 0.1-0.2 is typical. Shorter = snappier; longer = more distance.</p>

            <p><strong>"It feels like I have infinite dashes"</strong><br>
            Check <code>refreshOnGround</code> and <code>dashCount</code>. If grounded resets dash instantly, add a brief window.</p>

            <p><strong>"I'm taking damage during dash"</strong><br>
            <code>invincibleDuringDash</code> needs to be true, and your damage system needs to check for invincibility frames.</p>

            <h3>Direction Systems</h3>
            <table>
              <thead>
                <tr>
                  <th>System</th>
                  <th>Directions</th>
                  <th>Use Case</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><strong>FourWay</strong></td>
                  <td>Up, Down, Left, Right</td>
                  <td>Simple, classic</td>
                </tr>
                <tr>
                  <td><strong>EightWay</strong></td>
                  <td>+ Diagonals</td>
                  <td>Precise, modern platformers</td>
                </tr>
                <tr>
                  <td><strong>Horizontal</strong></td>
                  <td>Left, Right only</td>
                  <td>Ground-focused videogames</td>
                </tr>
                <tr>
                  <td><strong>Aim-Based</strong></td>
                  <td>Follows mouse/stick direction</td>
                  <td>Twin-stick, shooters</td>
                </tr>
                <tr>
                  <td><strong>Movement-Based</strong></td>
                  <td>Follows current velocity</td>
                  <td>Momentum-focused</td>
                </tr>
              </tbody>
            </table>

            <h3>Combine With</h3>
            <ul>
              <li><a href="coyote-time.html">Coyote Time</a> - brief dash window after leaving platform</li>
              <li><a href="double-jump.html">Double Jump</a> - dash extends air mobility</li>
              <li><a href="hitstop.html">Hitstop</a> - freeze when dash-attack connects</li>
              <li><a href="screen-shake.html">Screen Shake</a> - on dash-attack impact</li>
              <li><a href="squash-stretch.html">Squash & Stretch</a> - visual stretch during dash</li>
            </ul>
          </div>
        </div>

        <!-- CRAFT REGISTER -->
        <div class="register register--craft collapsed">
          <div class="register-header" onclick="this.parentElement.classList.toggle('collapsed')">
            Craft <span class="register-label">- for educators</span>
          </div>
          <div class="register-content">
            <h3>Why Teach Dash</h3>
            <p>Dash introduces students to <strong>resource management in movement</strong>. Unlike jump (which is almost always available), dash often has a count or cooldown. This creates decisions: "Should I dash now or save it?"</p>

            <h3>Teaching Sequence</h3>
            <ol>
              <li>Start with unlimited dashes, no cooldown - feel the basic mechanic</li>
              <li>Add dashCount = 1 with refreshOnGround - introduces resource thinking</li>
              <li>Add invincibility - changes how dash is used (evasion vs. movement)</li>
              <li>Experiment with direction systems</li>
            </ol>

            <h3>Common Student Mistakes</h3>
            <p><strong>Making dash too similar to running:</strong> If dash speed is only 1.5x run speed, it doesn't feel special. It needs to feel like a distinct mode.</p>

            <p><strong>Forgetting cancel windows:</strong> Students implement dash that can't be interrupted. This feels unresponsive. Even committed dashes usually have late cancel windows.</p>

            <p><strong>Ignoring the resource:</strong> When dashCount is treated as infinite, students miss the design opportunity. One dash per airtime creates meaningful choices.</p>

            <h3>Assessment</h3>
            <ul>
              <li>Can they articulate why Celeste uses one dash per airtime?</li>
              <li>Can they explain how invincibility changes the dash's role?</li>
              <li>Can they design a dash that fits a specific videogame genre?</li>
            </ul>

            <h3>Exercise: Dash Role Analysis</h3>
            <p>Have students play three videogames with dashes (Celeste, Hades, Mega Man X). For each:</p>
            <ul>
              <li>What role does the dash serve? (Traversal? Evasion? Combat?)</li>
              <li>How does the resource system support that role?</li>
              <li>What would change if you removed dash invincibility?</li>
            </ul>
          </div>
        </div>

        <!-- THEORY REGISTER -->
        <div class="register register--theory collapsed">
          <div class="register-header" onclick="this.parentElement.classList.toggle('collapsed')">
            Theory <span class="register-label">- deeper grounding</span>
          </div>
          <div class="register-content">
            <h3>Heritage Notes</h3>
            <p>The dash evolved from several sources:</p>

            <p><strong>Mega Man X (1993)</strong> - Ground dash that changed the pace of action platformers. Made movement itself feel aggressive.</p>

            <p><strong>Fighting games</strong> - Air dashes in <em>Marvel vs. Capcom</em>, <em>Guilty Gear</em> created aerial mobility that felt distinct from jumping.</p>

            <p><strong>Modern platformers</strong> - <em>Celeste</em> refined the single-dash-per-air model into a precise tool.</p>

            <p>The dash is now so standard that its <em>absence</em> is notable. A platformer without dash feels deliberately retro.</p>

            <h3>Dash as Commitment</h3>
            <p>Dash represents a design philosophy: <strong>powerful but costly</strong>. Unlike jump (low commitment, low power), dash trades control for speed. You're locked into a direction.</p>

            <p>This connects to <a href="../framework/permissions.html" class="term">Permissions</a>: dash <em>allows</em> burst movement but <em>requires</em> commitment. It <em>forbids</em> changing direction mid-dash. The permissions shape the feel.</p>

            <h3>The Invincibility Question</h3>
            <p>Adding invincibility to dash transforms it from <em>movement tool</em> to <em>survival tool</em>. This changes everything:</p>
            <ul>
              <li>Players dash <em>through</em> attacks, not around them</li>
              <li>Dash timing becomes a core skill</li>
              <li>Enemy design must account for i-frames</li>
            </ul>
            <p>The decision to include invincibility is one of the most impactful in action videogame design.</p>

            <h3>The Celeste Model</h3>
            <p><em>Celeste</em> made the dash-per-airtime model canonical for precision platformers. Key insights:</p>
            <ul>
              <li>One dash per air period creates meaningful scarcity</li>
              <li>Eight directions enables precise positioning</li>
              <li>Refreshing on ground makes failure recoverable</li>
              <li>Brief invincibility forgives close calls</li>
            </ul>
            <p>This model is now the default expectation. Deviating from it is a deliberate choice.</p>

            <h3>Unresolved Questions</h3>
            <ul>
              <li>How much should momentum carry after dash? Full stop vs. smooth transition creates very different feels.</li>
              <li>Should dash refresh on other surfaces (walls, enemies)? Each refresh point changes level design possibilities.</li>
              <li>Is the Celeste model becoming too dominant? Are we losing variety in dash design?</li>
            </ul>
          </div>
        </div>

        <hr>

        <h2>Related</h2>
        <ul>
          <li><a href="../framework/gesture.html">Gesture</a> - dash as canonical gesture</li>
          <li><a href="../framework/aesthetic-heritage.html">Aesthetic Heritage</a> - dash lineage</li>
          <li><a href="trail-effect.html">Trail Effect</a> - common visual pairing</li>
        </ul>

        <h2>Glossary Terms</h2>
        <ul>
          <li><a href="../glossary.html#invincibility-frames" class="term">Invincibility Frames</a> - damage immunity period</li>
          <li><a href="../glossary.html#cancel-window" class="term">Cancel Window</a> - when you can interrupt an action</li>
          <li><a href="../glossary.html#juice" class="term">Juice</a> - feedback techniques that make dash feel powerful</li>
        </ul>

      </div>
    </main>
  </div>

  <script src="../../js/main.js"></script>
</body>
</html>
